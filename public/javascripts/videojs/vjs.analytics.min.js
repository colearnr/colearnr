(function(){var e=[].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===e)return t;return-1};videojs.plugin("videoAnalytics",function(t){var i,a,n,s,l,r,c,o,d,h,u,p,m,f,v,y,g,b,_,T,M;null==t&&(t={}),i={},this.options()["data-setup"]&&(h=JSON.parse(this.options()["data-setup"]),h.videoAnalytics&&(i=h.videoAnalytics)),a=["loaded","percentsPlayed","start","srcType","ended","seek","play","pause","resize","volumeChange","error","fullscreen","close","firstplay"],c=t.eventsToTrack||i.eventsToTrack||a,m=t.percentsPlayedInterval||i.percentsPlayedInterval||5,l=t.eventCategory||i.eventCategory||"Video",r=t.eventLabel||i.eventLabel,lbit_id=t.lbit_id||i.lbit_id,topic_id=t.topic_id||i.topic_id,techName="video",lastValue=null,p=[],g=y=0,b=!1,d=function(){var t,i,a;r||(r=this.currentSrc().split("/").slice(-1)[0].replace(/\.(\w{3,4})(\?.*)?$/i,"")),e.call(c,"loadedmetadata")>=0&&_("loadedmetadata",!0),e.call(c,"srcType")>=0&&(a=this.currentSrc().split("."),t=a[a.length-1],i=this.contentEl().getElementsByClassName("vjs-tech")[0].id,_("source type - "+(""+i+"/"+t),!0))},T=function(){var t,i,a,n,s;for(t=Math.round(this.currentTime()),i=Math.round(this.duration()),n=Math.round(t/i*100),m=20/i*100,a=s=0;99>=s;a=s+=m)n>=a&&e.call(p,a)<0&&(e.call(c,"start")>=0&&0===a&&n>0?(tmpSrcArray=this.currentSrc().split("."),sourceType=tmpSrcArray[tmpSrcArray.length-1],techName=this.contentEl().getElementsByClassName("vjs-tech")[0].id,_("start",!0,t)):e.call(c,"percentsPlayed")>=0&&0!==n&&_("play",!0,t),n>0&&p.push(a));e.call(c,"seek")>=0&&(g=y,y=t,Math.abs(g-y)>1&&(b=!0,_("cue",!1,y)))},n=function(){var e=Math.round(this.currentTime());_("end",!0,e),$(".embed-title").length&&$(".embed-title").fadeIn(200),$(".embed-description").length&&$(".embed-description").fadeIn(200)},f=function(){var e;e=Math.round(this.currentTime()),e>0&&!b&&_("play",!0,e),$(".embed-title").length&&$(".embed-title").fadeOut(),$(".embed-description").length&&$(".embed-description").fadeOut(),b=!0},u=function(){var e,t;e=Math.round(this.currentTime()),t=Math.round(this.duration()),_("pause",!1,e),$(".embed-title").length&&$(".embed-title").fadeIn(200),$(".embed-description").length&&$(".embed-description").fadeIn(200)},close=function(){var e,t;e=Math.round(this.currentTime()),t=Math.round(this.duration()),e===t||b||_("close",!1,e)},M=function(){var e;e=this.muted()===!0?0:this.volume(),_("volume change",!1,e)},v=function(){_("resize - "+this.width()+"*"+this.height(),!0)},s=function(){var e;e=Math.round(this.currentTime()),_("error",!0,e)},o=function(){var e;e=Math.round(this.currentTime()),this.isFullscreen()?_("enter fullscreen",!1,e):_("exit fullscreen",!1,e)},_=function(e,t,i){switch(e){case"play":case"pause":case"cue":if($.postMessage){var a=document.getElementById("lbit-discuss-frame");a&&a.contentWindow&&$.postMessage(JSON.stringify({techName:this.techName,lbit_id:lbit_id,topic_id:topic_id,currentTime:i}),"*",a.contentWindow)}}try{if(lastValue&&lastValue==i)return;var n="/vid_track";this.techName&&-1!=this.techName.indexOf("youtube")?n="/yt_track":this.techName&&-1!=this.techName.indexOf("vimeo")&&(n="/vim_track"),$.get(n+"?lbit_id="+lbit_id+"&topic_id="+topic_id+"&e="+e+"&t="+i),i&&(lastValue=i)}catch(s){}},this.on("loadedmetadata",d),this.on("timeupdate",T),e.call(c,"ended")>=0&&this.on("ended",n),e.call(c,"play")>=0&&this.on("play",f),e.call(c,"firstplay")>=0&&this.on("firstplay",f),e.call(c,"pause")>=0&&this.on("pause",u),e.call(c,"volumeChange")>=0&&this.on("volumechange",M),e.call(c,"resize")>=0&&this.on("resize",v),e.call(c,"error")>=0&&this.on("error",s),e.call(c,"fullscreen")>=0&&this.on("fullscreenchange",o),e.call(c,"close")>=0&&this.on("close",close)})}).call(this);