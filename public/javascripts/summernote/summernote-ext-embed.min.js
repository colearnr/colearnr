!function(e){var n=e.summernote.renderer.getTemplate(),t=e.summernote.eventHandler.getEditor(),r=e.summernote.core.range,o=e.summernote.core.dom,i=function(e,n,t){var o=n.url,i=n.embedLink,a=n.range,d=function(){var e=a.insertNode(l(n));r.createFromNode(e).select()};a=a.deleteContents(),i&&t.onCreateLink?t.onCreateLink(o,e,n,t):d()},a=function(n,t){var r,o="980",i="620";return"small"==t.toLowerCase()?(o="500",i="420"):"medium"==t.toLowerCase()&&(o="740",i="520"),r=e('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen class="flex-embed">').attr("src",n).attr("width",o).attr("height",i).attr("frameborder",0),r[0]},l=function(n){var t=n.url,r=n.text,o=n.newWindow,i=n.embedLink,a=e("<A>"+r+"</A>");return e(a).attr({href:t,target:o?"_blank":"","data-embed":i?"true":"false"}),a[0]},d=function(e,n){e.toggleClass("disabled",!n),e.attr("disabled",!n)},s=function(n){n.focus();var t=r.create().expand(o.isAnchor),i=e(t.nodes(o.isAnchor)[0]);return{range:t,text:t.toString(),isNewWindow:i.length?"_blank"===i.attr("target"):!0,url:i.length?i.attr("href"):"",isEmbed:i.length?"true"===i.attr("data-embed"):!0}},c=function(n,t,r){return e.Deferred(function(e){var n=t.find(".note-embed-dialog"),o=n.find(".note-embed-text"),i=n.find(".note-embed-url"),a=n.find(".note-embed-btn"),l=n.find("#openInNewWindow"),s=n.find("#embedLink");n.one("shown.bs.modal",function(){o.val(r.text),o.on("input",function(){r.text=o.val()}),r.url||(r.url=r.text,d(a,r.text)),i.on("input",function(){d(a,i.val()),r.text||o.val(i.val())}).val(r.url).trigger("focus").trigger("select"),l.prop("checked",r.newWindow),s.prop("checked",r.embedLink),a.one("click",function(t){t.preventDefault(),e.resolve({range:r.range,url:i.val(),text:o.val(),newWindow:l.is(":checked"),embedLink:s.is(":checked")}),n.modal("hide")})}).one("hidden.bs.modal",function(){o.off("input"),i.off("input"),a.off("click"),"pending"===e.state()&&e.reject()}).modal("show")}).promise()};e.summernote.addPlugin({name:"embed",buttons:{embed:function(){return n.iconButton("fa fa-link",{event:"showEmbedDialog",title:"Link",hide:!0})}},dialogs:{embed:function(e,t){var r='<div class="form-group row"><label>'+e.link.textToDisplay+'</label><input class="note-embed-text form-control span12" type="text" /></div><div class="form-group row"><label>'+e.link.url+'</label><input class="note-embed-url form-control span12" type="text" /></div>'+(t.disableLinkTarget?"":'<div class="checkbox"><label><input name="openInNewWindow" id="openInNewWindow" type="checkbox" checked> '+e.link.openInNewWindow+"</label></div>")+(t.disableLinkEmbed?"":'<div class="checkbox"><label><input name="embedLink" id="embedLink" type="checkbox" checked> Embed this link</label></div>'),o='<button href="#" class="btn btn-primary note-embed-btn disabled" disabled>'+e.link.insert+"</button>";return n.dialog("note-embed-dialog",e.link.insert,r,o)}},events:{showEmbedDialog:function(e){var n=e.editor(),r=e.dialog(),o=e.editable(),a=s(o),l=n.data("options");t.saveRange(o),c(o,r,a).then(function(e){t.restoreRange(o),i(o,e,l)}).fail(function(){t.restoreRange(o)})},createIFrameNode:function(e,n,r){var o=e.editable();t.restoreRange(o);var i=a(n,r);return t.insertNode(o,i),i},createSimpleLinkNode:function(e,n,r){var o=e.editable();t.restoreRange(o);var i=l(r);return t.insertNode(o,i),i}}})}(jQuery);